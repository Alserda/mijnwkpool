<% title "Voorspellingen - #{@pool.name}" %>
<div class='grid-r'>
  <div class='medium-3-4'>
    <div class='box'>
      <div class="content-header">
        <h1>Mijn voorspellingen</h1>
      </div>
      <div id="contentflash" class="contentflash success">
        <div class="view-table">
          <div class="view-row">
            <div class="contentflash-text-center">Je voorspelt nu voor: <strong><%= @pool.name %></strong></div>
          </div>
        </div>
      </div>

      <div class="prediction-steps">
        <div class="steps">
          <%= link_to prediction_path(@pool.id) do %>                  
            <div class="step active">
              <span class="small-hide">1.</span> <span class="default-hide small-show">Poule wedstrijden</span>
            </div>
          <% end %>
            
          <%= link_to teamprediction_path(@pool.id) do %>          
            <div class="step active">
              <span class="small-hide">2.</span> <span class="default-hide small-show">Poule eindstanden</span>
            </div>            
          <% end %>

          <%= link_to knockoutprediction_path(@pool.id) do %>
            <div class="step ">
                <span class="small-hide">3.</span> <span class="default-hide small-show">Knock-out fase</span>
            </div>            
          <% end %>

          <div class="step">
            <span class="small-hide">4.</span> <span class="default-hide small-show">Bonus vragen</span>
          </div>
        </div>
      </div>
      <div class="pooldashboard-content">
        <h2>Poule eindstanden</h2>
        <div class="content-btn">
          <div class="center">
            <%= link_to 'Eindstanden aanpassen', edit_teamprediction_path(@pool.id), :class => 'btn grey right' %>
          </div>
        </div>

        <%= form_tag controller: :teampredictions, action: :create_multiple_teampredictions do %>
          <% @teamlist.sort.each_with_index do |(poule, teams), index| %>
              <table class="table poule">            
                <thead>
                  <tr>
                    <th class="groupname" colspan="1">Groep <%= poule %></th>
                    <th>Voorspelling</th>
                    <th></th>
                    <th class="default-hide small-show">Uitslag</th>
                    <th class="default-hide small-show">Punten</th>
                    <th></th>
 
                  </tr>
                </thead>

                <tbody>
                  <% teams.each_with_index do |team, index2| %>
                    <% current_poolmembership = Poolmembership.find_by_user_id_and_pool_id(current_user.id, @pool.id) %>
                    <% teamprediction = Teamprediction.find_by_poolmembership_id_and_team_id(current_poolmembership, team.id) %>
                    <% team = Team.find(team.id) %>

                    <%= fields_for "teampredictions[#{index}#{index2}]", Teamprediction.new do |p| %>
                      <%= p.hidden_field :poolmembership_id, :value => Poolmembership.find_by_user_id_and_pool_id(current_user.id, @pool.id).id %>
                      <tr>
                        <td class="flag" style="background-image: url('<%= team.avatar.url(:mini)%>')">
                        </td>
                        <td class="predict-score">
                          <% if teamprediction.present? %>
                            <%= teamprediction.pouleposition %>
                          <% end %>
                        </td>
                        <td class="default-hide small-show">
                            <%= team.name %>
                        </td>
                          <td class="default-hide small-show">
                        <% if team.originalposition == nil %>

                        <% else %>
                          <%= team.originalposition %>
                        <% end %>
                      </td>
                      <td class="bold
                        <% if teamprediction.present? && !(team.originalposition == nil) %>
                          <% if teamprediction.pointsearned == 3 %>
                            green
                          <% elsif teamprediction.pointsearned == 0 %>
                            red
                          <% else %>
                          <% end %>
                        <% else %>
                          x
                        <% end %>
                      ">
                        <% if teamprediction.present? && !(team.originalposition == nil) %>
                          <%= teamprediction.pointsearned %>
                        <% else %>
                          x
                        <% end %>
                      </td>
                      </tr>
                    <% end %>
                  <% end %>
                </tbody>
              </table>
          <% end %>

          <div class="content-btn">          
            <div class="center">
              <%= link_to 'Eindstanden aanpassen', edit_teamprediction_path(@pool.id), :class => 'btn grey' %>
            </div>
          </div>

          <div class="content-btn">
            <div class="left">
              <%= link_to prediction_path(@pool.id), :class => 'btn green left' do %>
                <i class="fa fa-chevron-left"></i> Vorige
              <% end %>
            </div>          
            <div class="right">
              <%= link_to knockoutprediction_path(@pool.id), :class => 'btn green left' do %>
                Volgende <i class="fa fa-chevron-right"></i>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class='default-0 medium-1-4'>
    <%= render "shared/aside" %>
    <%= render "shared/aside_admin" %>
    <%= render "shared/aside_ad" %>
  </div>
</div>

<script type="text/javascript">
$(".infoshower").hover(function () {
  $(this).find(".hiddeninfo").fadeIn('fast');
}, function () {
  $(this).find(".hiddeninfo").fadeOut('fast');
});
</script>

